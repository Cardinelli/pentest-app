from django.shortcuts import render
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt

import socket
import whois


def index(request):
    return render(request, 'scan/index.html')


@csrf_exempt
def who_is(request):
    if request.is_ajax and request.method == "POST":
        domain = request.POST['target-input']
        ip = get_domain_ip(domain)
        res = whois.whois(domain)

        return JsonResponse({"data": res, "ip": ip}, status=200)
    return JsonResponse({"instance": "error"}, status=500)


def get_domain_ip(domain):
    return socket.gethostbyname(domain)
